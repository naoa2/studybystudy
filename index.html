<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Advanced Calculation Engine</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net"></script>
    <style>
        @import url('https://fonts.googleapis.com');
        body { font-family: sans-serif; margin: 0; background: #f3f4f6; overflow: hidden; touch-action: manipulation; }
        .screen { display: none; min-height: 100vh; width: 100%; flex-direction: column; align-items: center; justify-content: center; position: fixed; top:0; left:0; z-index: 10; }
        .screen.active { display: flex !important; }
        
        /* Áâ©ÁêÜÁöÑ„Å™„ÄåÊäº„ÅóÂøÉÂú∞„Äç„Çí‰øùË®º */
        button { cursor: pointer !important; transition: 0.1s; }
        button:active { transform: scale(0.92) !important; filter: brightness(0.8); }
        .calc-btn { background: #fff; border: 1px solid #ddd; height: 60px; font-size: 1.5rem; border-radius: 12px; font-weight: bold; }

        /* „Ç¥„Éº„Ç∏„É£„Çπ„Éá„Ç∂„Ç§„É≥ */
        .lounge { background: #000; color: #d4af37; font-family: 'Noto Serif JP', serif; }
        .gold-text { background: linear-gradient(to right, #bf953f, #fcf6ba, #aa771c); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-family: 'Cinzel', serif; }
        .gold-btn { background: linear-gradient(135deg, #bf953f, #aa771c); color: #000; font-weight: 900; border: none; border-radius: 4px; }
        .post-card { background: #0a0a0a; border: 1px solid #2d2410; padding: 25px; margin-bottom: 25px; border-left: 5px solid #aa771c; text-align: left; }
        
        textarea, input { background: #111 !important; color: #fff !important; border: 1px solid #333 !important; padding: 15px; border-radius: 4px; outline: none; }
        input:focus { border-color: #aa771c !important; }
    </style>
</head>
<body>

    <!-- [1] „Ç´„É¢„Éï„É©ÈõªÂçì -->
    <div id="scr-1" class="screen active">
        <div class="bg-white p-8 rounded-[2.5rem] shadow-2xl w-full max-w-[340px] border border-gray-200">
            <div id="disp" class="bg-gray-900 text-green-400 text-right p-4 text-4xl font-mono rounded-2xl mb-6 h-24 flex items-center justify-end overflow-hidden shadow-inner">0</div>
            <div class="grid grid-cols-4 gap-3">
                <button class="calc-btn col-span-3 text-red-500" onclick="k('AC')">AC</button><button class="calc-btn bg-gray-100" onclick="k('/')">√∑</button>
                <button class="calc-btn" onclick="k('7')">7</button><button class="calc-btn" onclick="k('8')">8</button><button class="calc-btn" onclick="k('9')">9</button><button class="calc-btn bg-gray-100" onclick="k('*')">√ó</button>
                <button class="calc-btn" onclick="k('4')">4</button><button class="calc-btn" onclick="k('5')">5</button><button class="calc-btn" onclick="k('6')">6</button><button class="calc-btn bg-gray-100" onclick="k('-')">-</button>
                <button class="calc-btn" onclick="k('1')">1</button><button class="calc-btn" onclick="k('2')">2</button><button class="calc-btn" onclick="k('3')">3</button><button class="calc-btn bg-gray-100" onclick="k('+')">+</button>
                <button class="calc-btn col-span-2" onclick="k('0')">0</button><button class="calc-btn" onclick="k('.')">.</button><button class="calc-btn bg-blue-600 text-white" onclick="k('=')">=</button>
            </div>
        </div>
        <p class="mt-8 text-gray-400 text-[10px] uppercase tracking-[0.5em]">Academic Support System v11.0</p>
    </div>

    <!-- [2] ÁßòÂØÜ„Ç≥„Éº„ÉâÂÖ•Âäõ -->
    <div id="scr-2" class="screen lounge">
        <h2 class="gold-text text-2xl mb-10 tracking-[0.5em] font-black uppercase">Authentication</h2>
        <input type="password" id="pw1" class="w-64 text-center text-4xl mb-10" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
        <button onclick="auth1()" class="w-64 gold-btn py-5 shadow-2xl text-lg">ACCESS</button>
    </div>

    <!-- [3] „Ç¢„Ç´„Ç¶„É≥„Éà‰ΩúÊàê -->
    <div id="scr-3" class="screen lounge">
        <h2 class="gold-text text-4xl mb-10 italic font-black">Registry</h2>
        <input type="text" id="nick" class="w-64 text-center text-xl mb-12" placeholder="Your Name">
        <button onclick="reg()" class="w-64 gold-btn py-5">JOIN THE LOUNGE</button>
    </div>

    <!-- [4] Êé≤Á§∫Êùø -->
    <div id="scr-4" class="screen lounge justify-start overflow-y-auto pt-28">
        <header class="w-full bg-black/95 border-b border-zinc-900 px-8 py-6 flex justify-between items-center fixed top-0 z-50">
            <h1 onclick="goAdminAuth()" class="gold-text text-3xl font-black italic cursor-pointer select-none">THE LOUNGE</h1>
            <span id="badge" class="text-[9px] gold-text border border-[#aa771c] px-4 py-1.5 uppercase tracking-widest bg-black"></span>
        </header>
        <div id="feed" class="w-full max-w-4xl px-8 pb-96"></div>
        <div class="fixed bottom-0 w-full p-8 bg-gradient-to-t from-black via-black">
            <div class="max-w-4xl mx-auto bg-[#0a0a0a] p-6 gold-border shadow-2xl text-center">
                <textarea id="msg" class="w-full h-24 mb-6 text-lg" placeholder="ÊÄùËÄÉ„ÇíÂêåÊúü„Åô„Çã..."></textarea>
                <div class="flex justify-between items-center">
                    <label class="text-[10px] gold-text font-bold cursor-pointer border border-[#3d3420] px-6 py-3 hover:bg-[#111]">
                        üìé MEDIA ATTACH
                        <input type="file" id="file" accept="image/*" class="hidden">
                    </label>
                    <button onclick="post()" class="gold-btn px-16 py-4 shadow-xl">SYNCHRONIZE</button>
                </div>
            </div>
        </div>
    </div>

    <!-- [5] ÁÆ°ÁêÜËÄÖ„É≠„Ç∞„Ç§„É≥ -->
    <div id="scr-5" class="screen lounge">
        <div class="w-full max-w-sm p-12 border-4 border-red-900 bg-black text-center shadow-2xl">
            <h2 class="text-red-600 font-bold mb-10 tracking-widest uppercase">Overseer Access</h2>
            <input type="password" id="pw2" class="w-full bg-black border-2 border-red-900 text-red-600 text-center text-2xl mb-10" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            <button onclick="auth2()" class="w-full bg-red-900 text-white py-5 font-black tracking-widest">GRANT ACCESS</button>
            <button onclick="nav(4)" class="mt-6 text-gray-600 text-xs underline">Back</button>
        </div>
    </div>

    <!-- [6] ÁÆ°ÁêÜÁîªÈù¢ -->
    <div id="scr-6" class="screen lounge justify-start p-10 pt-28 overflow-y-auto">
        <div class="w-full max-w-5xl mx-auto">
            <h2 class="gold-text text-3xl mb-12 border-b border-[#333] pb-4 font-black">SYSTEM CONSOLE</h2>
            <div class="grid md:grid-cols-2 gap-16 font-mono text-[11px]">
                <div><h3 class="text-red-700 mb-6 uppercase underline font-bold">Purge Protocol</h3><div id="adm-p" class="space-y-3"></div></div>
                <div><h3 class="text-blue-700 mb-6 uppercase underline font-bold">Node Termination</h3><div id="adm-u" class="space-y-3"></div></div>
            </div>
            <button onclick="nav(4)" class="mt-12 gold-border px-8 py-3 text-xs">LOGOUT</button>
        </div>
    </div>

    <!-- [BAN] „Ç¢„ÇØ„Çª„ÇπÊãíÂê¶ -->
    <div id="scr-ban" class="screen bg-black text-red-700 font-mono">
        <h1 class="text-6xl font-black mb-6 italic tracking-tighter uppercase">Terminated</h1>
        <p class="text-sm opacity-50 underline tracking-[0.5em]">Security Violation: Node Blocklisted.</p>
    </div>

    <script>
        // --- ‚öôÔ∏è Supabase Ë®≠ÂÆö ---
        const URL = "https://ouwdksthlsouvlkqxfqh.supabase.co";
        const KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im91d2Rrc3RobHNvdXZsa3F4ZnFoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA5MjA1OTMsImV4cCI6MjA4NjQ5NjU5M30.3RfDDpqJ1bweEtcFO9IZtAeGVWEAwEo-tTH534wDlbk";
        const sb = window.supabase.createClient(URL, KEY);

        let user = localStorage.getItem('g_user') || "";
        let exp = "";

        // --- üì± ÁîªÈù¢Âàá„ÇäÊõø„Åà (Âç≥ÊôÇÂèçÂøú) ---
        function nav(n) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            const target = document.getElementById('scr-' + n);
            if(target) target.classList.add('active');
            if(n === 4) { document.getElementById('badge').innerText = user; sync(); }
            if(n === 6) renderAdmin();
            window.scrollTo(0,0);
        }

        // --- üßÆ ÈõªÂçì„Ç®„É≥„Ç∏„É≥ (ÈÄö‰ø°‰∏çË¶Å„ÅßÁàÜÈÄü) ---
        function k(v) {
            const d = document.getElementById('disp');
            if(v === 'AC') exp = "";
            else if(v === '=') {
                if(exp === "777") { exp = ""; nav(2); return; }
                try { exp = eval(exp.replace('√∑','/').replace('√ó','*')).toString(); } catch(e) { exp = "Error"; }
            } else { exp += v; }
            d.innerText = exp || "0";
        }

        // --- üîê Ë™çË®º ---
        async function auth1() {
            if(document.getElementById('pw1').value === 'neba72') {
                const { data } = await sb.from('posts').select('*').eq('content', '[TERMINATED]').eq('user', user);
                if (data && data.length > 0) { nav('ban'); return; }
                if(user) nav(4); else nav(3);
            }
        }
        function reg() { const n = document.getElementById('nick').value.trim(); if(n) { user = n; localStorage.setItem('g_user', n); nav(4); } }

        // --- ü•Ç Êé≤Á§∫Êùø ---
        async function post() {
            const t = document.getElementById('msg').value;
            const f = document.getElementById('file').files;
            let b64 = "";
            if(f && f[0]) b64 = await new Promise(r => { const rd = new FileReader(); rd.onload = () => r(rd.result); rd.readAsDataURL(f[0]); });
            if(t || b64) {
                await sb.from('posts').insert([{ user: user, content: t, image: b64 }]);
                document.getElementById('msg').value = ""; document.getElementById('file').value = "";
                sync();
            }
        }

        async function sync() {
            const { data } = await sb.from('posts').select('*').neq('content', '[TERMINATED]').order('created_at', { ascending: false });
            if(!data) return;
            document.getElementById('feed').innerHTML = data.map(p => `
                <div class="post-card shadow-2xl">
                    <div class="flex justify-between mb-5 items-center">
                        <span class="gold-text text-sm font-black uppercase italic tracking-widest">${p.user}</span>
                        <span class="text-[9px] text-zinc-700">${new Date(p.created_at).toLocaleString()}</span>
                    </div>
                    <p class="text-lg text-gray-200 leading-relaxed whitespace-pre-wrap">${p.content || ""}</p>
                    ${p.image ? `<img src="${p.image}" class="mt-8 border border-zinc-900 shadow-2xl w-full">` : ''}
                </div>`).join('');
        }

        // --- üëë ÁÆ°ÁêÜËÄÖ ---
        function goAdminAuth() { nav(5); }
        function auth2() { if(document.getElementById('pw2').value === 'e9271324') nav(6); }

        async function renderAdmin() {
            const { data } = await sb.from('posts').select('*').order('created_at', { ascending: false });
            if(!data) return;
            document.getElementById('adm-p').innerHTML = data.filter(p=>p.content!=='[TERMINATED]').map(p => `
                <div class="bg-zinc-950 p-4 flex justify-between border border-zinc-900 items-center">
                    <span class="truncate max-w-[200px] text-zinc-500">${p.user}: ${p.content ? p.content.slice(0,15) : "IMG"}</span>
                    <button onclick="delP(${p.id})" class="text-red-700 font-bold border border-red-900 px-4 py-1">PURGE</button>
                </div>`).join('');
            const users = [...new Set(data.map(p => p.user))];
            document.getElementById('adm-u').innerHTML = users.map(u => `
                <div class="bg-zinc-950 p-4 flex justify-between border border-zinc-900 items-center">
                    <span class="gold-text italic font-bold">${u}</span>
                    <button onclick="banU('${u}')" class="text-red-700 font-bold border border-red-900 px-4 py-1">TERMINATE</button>
                </div>`).join('');
        }

        window.delP = async (id) => { await sb.from('posts').delete().eq('id', id); renderAdmin(); sync(); };
        window.banU = async (u) => { 
            await sb.from('posts').insert([{ user: u, content: '[TERMINATED]' }]); 
            await sb.from('posts').delete().eq('user', u).neq('content', '[TERMINATED]');
            renderAdmin(); 
        };
    </script>
</body>
</html>
